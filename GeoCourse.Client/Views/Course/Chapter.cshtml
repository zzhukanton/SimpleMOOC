
@{
	ViewBag.Title = "Chapter";
}

<h2>@ViewBag.Chapter.Chapter</h2>
<div style="margin-top: 30px; margin-bottom: 30px">
	<p>@ViewBag.Chapter.Description</p>
</div>

<div class="col-md-12">
	<iframe src="@Url.Action("LoadPdf", "Course", new { @path = ViewBag.Chapter.DocumentPath as string })" style="height: 550px; width: 100%;" type="application/pdf"></iframe>
</div>

<div class="col-md-12">
	@if (ViewBag.IsCourseFinished)
	{
		<div class="row custom-row col-md-12">
			<p class="">К сожалению, вы уже не можете проходить этот тест, поскольку курс уже завершен. Чтобы пройти финальный тест, на странице курса перейдите по ссылке на финальный тест. Помните, что на финальный тест дается только одна попытка сдачи.</p>
		</div>
	}
	else
	{
		if (ViewBag.LatestTestResult.CurrentTryCount == 0)
		{
			<div class="row custom-row text-center">
				<p class="text-success">Вы еще не проходили тест по этому разделу. Нажмите "Пройти тест" чтобы начать.</p>
			</div>
			<div class="row">
				<div class="col-md-4">
					@if (!ViewBag.IsFirstChapter)
					{
						<p>@Html.ActionLink("Назад", "Chapter", "Course", new { id = (int)(ViewBag.Chapter.TestId - 1) }, new { @class = "btn btn-default btn-lg" })</p>
					}
				</div>
				<div class="col-md-4">
					<div class="text-center">
						@Html.ActionLink("Пройти тест", "Test", "Test", new { id = (int)ViewBag.Chapter.TestId }, new { @class = "btn btn-danger btn-lg" })
					</div>
				</div>
				<div class="col-md-4" id="next">
					@if (!ViewBag.IsLastChapter)
					{
						<p>@Html.ActionLink("Вперед", "Chapter", "Course", new { id = (int)(ViewBag.Chapter.TestId + 1) }, new { @class = "btn btn-default btn-lg", @id = "next" })</p>
					}
				</div>
			</div>
		}
		else if (ViewBag.LatestTestResult.CurrentTryCount == 1)
		{
			<div class="row custom-row text-center">
				<p class="text-success">Ваш предыдущий результат: <span style="color: chocolate"> @ViewBag.LatestTestResult.PointCount </span> правильных ответов. Чтобы пройти тест еще раз, нажмите на "Пройти тест".
			</div>
			<div class="row">
				<div class="col-md-4">
					@if (!ViewBag.IsFirstChapter)
					{
						<p>@Html.ActionLink("Назад", "Chapter", "Course", new { id = (int)(ViewBag.Chapter.TestId - 1) }, new { @class = "btn btn-default btn-lg" })</p>
					}
				</div>
				<div class="col-md-4">
					<div class="text-center">
						@Html.ActionLink("Пройти тест", "Test", "Test", new { id = (int)ViewBag.Chapter.TestId }, new { @class = "btn btn-danger btn-lg" })
					</div>
				</div>
				<div class="col-md-4">
					@if (!ViewBag.IsLastChapter)
					{
						<p>@Html.ActionLink("Вперед", "Chapter", "Course", new { id = (int)(ViewBag.Chapter.TestId + 1) }, new { @class = "btn btn-default btn-lg", @id = "next" })</p>
					}
				</div>
			</div>
		}
		else
		{
			<div class="row custom-row text-center">
				<p>Вы исчерпали лимит попыток сдачи данного теста. Ваш результат: <span style="color: chocolate"> @ViewBag.LatestTestResult.PointCount </span>правильных ответа(ов).</p>
			</div>
			<div class="row">
				<div class="col-md-4">
					@if (!ViewBag.IsFirstChapter)
					{
						<p>@Html.ActionLink("Назад", "Chapter", "Course", new { id = (int)(ViewBag.Chapter.TestId - 1) }, new { @class = "btn btn-default btn-lg" })</p>
					}
				</div>
				<div class="col-md-4">
					<div class="text-center">
						@Html.ActionLink("Пройти тест", "Test", "Test", new { id = (int)ViewBag.Chapter.TestId }, new { @class = "btn btn-danger btn-lg", @disabled = "disabled" })
					</div>
				</div>
				<div class="col-md-4">
					@if (!ViewBag.IsLastChapter)
					{
						<p>@Html.ActionLink("Вперед", "Chapter", "Course", new { id = (int)(ViewBag.Chapter.TestId + 1) }, new { @class = "btn btn-default btn-lg", @id = "next" })</p>
					}
				</div>
			</div>
		}
	}
</div>